# 一文详解密码学Hash算法的安全问题(加盐+HMAC)

上一篇文章- [一文详解密码学中的Hash 算法](./hash.md) 我们介绍了密码学中Hash算法的性质、分类以及使用场景。在使用场景中，我们介绍了这些场景的具体使用方式方法。为了保持文章的连贯性和可读性， 对于其中的潜在安全问题，我们简单一笔带过。今天我们另开一篇文章，着重介绍密码学Hash算法的主要安全问题以及对应的解决办法。希望能大家使用密码学Hash算法带来更多维度的考量。

## 密码学Hash算法作为身份验证的安全问题

上一篇文章我们介绍了怎样使用密码学Hash算法的单向特性来作为用户身份验证的方案：

> 密码学Hash算法必须具备有单向性，也就是不可逆，不能从Hash值逆向推算出原始值，基于这种特性，我们可以用来进行用户身份验证。用户登录都需要进行用户名密码的校验，如果我们将用户密码存在数据库里面，一旦数据库泄露，那就所有人的密码都泄露了，这样的事情前几年发生了不少！那么如果我们将用户的原始密码进行Hash运算，并只是把Hash值保存在数据库里面，当用户登录时，我们计算用户输入密码的Hash值，并与数据库的Hash值进行比较，如果相同则验证通过，不同则失败。而用户的明文密码不进行保存，这样一来，万一数据库泄露了，也不会一下子泄露了全部的用户密码

简单地说 用户的密码在系统中变成了 f(p) = h(p), 而验证的时候， 计算h(p') = h(p), 其中p为用户设置的密码，p'为登录时用户输入的密码，这样系统就可以不用明文保存用户的密码。比如常见密码`password1` 用SHA256保存在数据库就变成了`0b14d501a594442a01c6859541bcb3e8164d183d32937b851835442f69d5c94e` , 登录时系统校验 SHA(input)是否等于这个Hash值，相同则通过验证。

感觉这样很可行，就连系统管理员直接查DB也不知道你的密码是什么，因为目前常用的Hash算法不可逆的特性都还没被打破，也就是基本没办法从Hash值反推出原始消息。

### 彩虹表 / 字典攻击

道高一尺魔高一丈！反推不行，那我就干脆“正推”。上一篇文章我们介绍Hash算法的时候有一个特性`相同的输入消息总是能得到相同的Hash值`. 那如果有一个Hash值的表，里面包含了原文以及Hash值，如果我的这个Hash值跟你系统的Hash值一样，那我就可以知道你的密码是什么了！！！

[https://baike.baidu.com/item/%E5%BD%A9%E8%99%B9%E8%A1%A8/689313?fr=aladdin](https://baike.baidu.com/item/彩虹表/689313?fr=aladdin)

### 

https://www.cmd5.com/

暴力破解

暴力破解：完全不知道密码----通过系统提供的认证接口不断认证----获取原始口令----处于进入系统前

彩虹表攻击：已知密码hash值----通过自己的工具及彩虹表不断查找----获取原始口令----处理进入系统后



脱裤 + 撞库



## Hash加盐

### 静态盐

### 随机盐

### 盐的存储

### Java加盐Hash的实现



## HMAC

Hash一致性校验的问题

HMAC

Java HMAC的实现

